class Modal{constructor(e,t){this.modal=document.querySelector(e),this.closeTriggers=this.modal.querySelectorAll(".js--fm-modal-close"),this.toggleTirggers=document.querySelectorAll(t),this.#events()}#events(){this.closeTriggers.forEach(e=>{e.addEventListener("click",()=>this.close())}),this.toggleTirggers.forEach(e=>{e.addEventListener("click",()=>this.open())})}open(){this.modal.classList.add("modal_active")}close(){this.modal.classList.remove("modal_active")}}class ModalDelete extends Modal{constructor(e,t,i=()=>{}){super(e,t),this.callback=i,this.title=this.modal.querySelector(".modal__title"),this.deleteTriggers=this.modal.querySelectorAll(".js--fm-modal-delete").forEach(e=>{e.addEventListener("click",()=>this.onDelete())})}open(e){this.modal.classList.add("modal_active"),e&&(this.title.textContent=e.title,this.callback=e.callback)}onDelete(){this.close(),this.callback()}}class ModalRename extends Modal{constructor(e,t,i){super(e,t),this.callback=i,this.pathField=this.modal.querySelector("input[name=path]"),this.prevNameField=this.modal.querySelector("input[name=prev_name]"),this.newNameField=this.modal.querySelector("input[name=new_name]"),this.modal.querySelectorAll(".js--fm-modal-rename-save").forEach(e=>{e.addEventListener("click",()=>{this.save()})})}getName(){return this.newNameField.value}open(e){this.pathField.value=e.path||"/",this.prevNameField.value=e.prevName||"",this.callback=e.callback,this.modal.classList.add("modal_active")}save(){this.close(),this.callback(this.newNameField.value),this.newNameField.value=""}}class ModalCreateFolder extends Modal{constructor(e,t,i){super(e,t),this.callback=i,this.nameField=this.modal.querySelector("input[name=name]"),this.modal.querySelectorAll(".js--fm-modal-save-trigger").forEach(e=>{e.addEventListener("click",()=>{this.save()})})}save(){this.close(),this.callback(this.nameField.value),this.nameField.value=""}}class ModalFileUploader extends Modal{constructor(e,t,i){super(e,t),this.fileInput=this.modal.querySelector(".file-uploader__input"),this.filesWrap=this.modal.querySelector(".file-uploader__files"),this.callback=i,this.path="/",this.modal.querySelectorAll(".js--fm-modal-file-save").forEach(e=>{e.addEventListener("click",()=>{this.onSave(),this.callback()})})}close(){this.modal.classList.remove("modal_active"),this.filesWrap.innerHTML="",this.filesWrap.style.display="none",this.callback&&this.callback()}setPath(e){this.path=e,this.fileInput.setAttribute("data-path",e)}get getPath(){return this.path}}function iniitTextFields(){document.querySelectorAll(".text-field").forEach(e=>{e.addEventListener("input",()=>{e.value.trim()?e.classList.add("text-field_has-value"):e.classList.remove("text-field_has-value")})})}function removeFileExtenstion(e){return e.replace(/\.[^/.]+$/,"")}function replaceLastPathElement(e,t){e=e.split("/");return e[e.length-1]=t,e.join("/")}function getFileExtenstion(e){return e.split(".").pop()}function formatEnding(e,t){return e+" "+t[4<e%100&&e%100<20?2:[2,0,1,1,1,2][Math.min(e%10,5)]]}function handleOutsideClick(t,i){function e(e){t&&!t.contains(e.target)&&i()}return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}function copyToClipboard(e){return new Promise((t,i)=>{if("undefined"!=typeof navigator&&void 0!==navigator.clipboard&&"undefined"!==navigator.permissions){var a="text/plain",a=new Blob([e],{type:a});const r=[new ClipboardItem({"text/plain":a})];navigator.permissions.query({name:"clipboard-write"}).then(e=>{"granted"===e.state||"prompt"===e.state?navigator.clipboard.write(r).then(t,i).catch(i):i(new Error("Permission not granted!"))})}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){a=document.createElement("textarea");a.textContent=e,a.style.position="fixed",a.style.width="2em",a.style.height="2em",a.style.padding=0,a.style.border="none",a.style.outline="none",a.style.boxShadow="none",a.style.background="transparent",document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy"),document.body.removeChild(a),t()}catch(e){document.body.removeChild(a),i(e)}}else i(new Error("None of copying methods are supported by this browser!"))})}async function download(e,t){var e=await(await fetch(e)).blob(),e=URL.createObjectURL(e),i=document.createElement("a");i.setAttribute("href",e),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}class ContextMenu{constructor(e,t){this.root=e,this.items=t,this.content=null,this.isShow=!1,this.events()}events(){window.addEventListener("resize",()=>{this.hide()}),handleOutsideClick(this.root,()=>this.hide())}#renderTemplate(a){const r=document.createElement("ul");r.classList.add("context-menu__items"),this.items.forEach(e=>{var t=document.createElement("li"),i=(t.classList.add("context-menu__item"),document.createElement("button"));i.classList.add("context-menu__link"),i.textContent=e.name,i.setAttribute("tabindex","0"),i.addEventListener("click",()=>{e.callback(a),this.hide()}),t.appendChild(i),r.appendChild(t)}),this.content=r,this.root.appendChild(r)}show(e){this.isShow||this.#renderTemplate(e),this.root.classList.add("context-menu_active"),this.isShow=!0,this.root.focus(),this.root.setAttribute("tabindex","0"),this.root.style.display="block",this.root.style.left=e.clientX+"px",this.root.style.top=e.clientY+"px"}hide(){this.content&&(this.isShow=!1,this.content.remove())}}class Toolbar{constructor(e,t){this.root=document.querySelector(e),this.items=t,this.#renderTemplate()}open(){this.root.classList.add("f-manager__tapbar_active")}close(){this.root.classList.remove("f-manager__tapbar_active")}#renderTemplate(){this.items.forEach(e=>{var t=document.createElement("button");t.classList.add("f-manager__tapbar-control","btn-menu"),t.innerHTML=`
      <i class="btn-menu__icon">
        ${e.icon}
      </i>
      <span class="btn-menu__text">${e.name}</span>
      `,t.addEventListener("click",e.callback),this.root.appendChild(t)})}}class Accordion{constructor(e){this.el=e,this.summary=e.querySelector("summary"),this.content=e.querySelector("ul"),this.animation=null,this.isClosing=!1,this.isExpanding=!1,this.summary.addEventListener("click",e=>this.onClick(e))}onClick(e){e.preventDefault(),this.el.style.overflow="hidden",this.isClosing||!this.el.open?this.open():(this.isExpanding||this.el.open)&&this.shrink()}shrink(){this.isClosing=!0;var e=this.el.offsetHeight+"px",t=this.summary.offsetHeight+"px";this.animation&&this.animation.cancel(),this.animation=this.el.animate({height:[e,t]},{duration:150}),this.animation.onfinish=()=>this.onAnimationFinish(!1),this.animation.oncancel=()=>this.isClosing=!1}open(){this.el.style.height=this.el.offsetHeight+"px",this.el.open=!0,window.requestAnimationFrame(()=>this.expand())}expand(){this.isExpanding=!0;var e=this.el.offsetHeight+"px",t=this.summary.offsetHeight+this.content.offsetHeight+"px";this.animation&&this.animation.cancel(),this.animation=this.el.animate({height:[e,t]},{duration:150}),this.animation.onfinish=()=>this.onAnimationFinish(!0),this.animation.oncancel=()=>this.isExpanding=!1}onAnimationFinish(e){this.el.open=e,this.animation=null,this.isClosing=!1,this.isExpanding=!1,this.el.style.height=this.el.style.overflow=""}}document.querySelectorAll("details").forEach(e=>{new Accordion(e)});class NotificationStack{constructor(e,t){this.stack=document.createElement("div"),this.stack.className="notifications",(e||document.querySelector("body")).appendChild(this.stack)}addNotification(e){const t=new Notification(this.stack,e);return setTimeout(()=>{t.hide()},3e3),t}}class Notification{constructor(e,t){this.stack=e,this.options=t,this.title=void 0!==t.title&&t.title,this.linkText=void 0!==t.linkText&&t.linkText,this.link=void 0!==t.link&&t.link,this.callback=void 0!==t.callback&&t.callback,this.autoHide=void 0!==t.autoHide&&t.autoHide,this.onClick=void 0!==t.onClick&&t.onClick,this.priority=void 0!==t.priority&&t.priority;e=`
		<div class="notification notification_active">
			${this.title?`<span class="notification__text">${this.title}</span>`:""}
			${this.linkText?`<a href="${this.link||"#"}" class="notification__link">${this.linkText}</a>`:""}
		</div>
		`;return this.element=document.createElement("div"),this.element.className=" notification-wrapper in",this.element.innerHTML=e,this.callback&&this.element.querySelector(".notification__link").addEventListener("click",()=>this.callback()),this.stack.prepend(this.element),this}hide(){this.element.classList.add("collapsed"),setTimeout(()=>this.element.remove(),600)}}const folderContext=document.getElementById("folder-context-menu"),fileContext=document.getElementById("file-context-menu"),FileManager={apiBase:"/bootstrap.php",rootDir:"",assetsDir:"",root:document.querySelector(".f-manager__wrapper"),workspace:null,notify:null,tree:null,fileGrid:null,filesMobile:null,breadcrumbs:null,toolbarDefault:null,toolbarFile:null,toolbarFolder:null,curPath:"",curFilePath:"",curDirPath:"",currFileName:"",files:{},folderContextMenu:null,fileContextMenu:null,deleteFolderTriggers:[],deleteFileTriggers:[],activeFolder:"",callback:()=>{},modalFiles:null,modalCreate:null,modalRename:null,modalDelete:null,init(e){this.workspace=this.root.querySelector(".f-manager"),this.tree=this.root.querySelector(".f-manager__tree"),this.fileGrid=this.root.querySelector(".f-manager__files-grid"),this.filesMobile=this.root.querySelector(".f-manager__files-column"),this.breadcrumbs=this.root.querySelector(".f-manager__nav-list"),this.deleteFolderTriggers=this.root.querySelectorAll(".js--fm-delete-folder"),this.deleteFileTriggers=this.root.querySelectorAll(".js--fm-delete-file"),this.callback=e,this.toolbarDefault=new Toolbar("#f-tapbar-default",[{name:"Назад",callback:()=>{var e;this.curDirPath?((e=this.curDirPath.split("/")).pop(),this.curDirPath=e.join("/"),this._navigate(this.curDirPath)):this.close()},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path d="M14.8 6L8.80005 12L14.8 18" stroke="#1461CC" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                `},{name:"Загрузить",callback:()=>{this.modalFiles.open()},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M21.4 15V16.2C21.4 17.8802 21.4 18.7202 21.073 19.362C20.7854 19.9265 20.3265 20.3854 19.762 20.673C19.1203 21 18.2802 21 16.6 21H8.20002C6.51987 21 5.67979 21 5.03805 20.673C4.47357 20.3854 4.01462 19.9265 3.727 19.362C3.40002 18.7202 3.40002 17.8802 3.40002 16.2V15M17.4 8L12.4 3M12.4 3L7.40002 8M12.4 3V15"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Создать",callback:()=>{this.modalCreate.open()},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path
                    d="M13 7L11.8845 4.76892C11.5634 4.1268 11.4029 3.80573 11.1634 3.57116C10.9516 3.36373 10.6963 3.20597 10.4161 3.10931C10.0992 3 9.74021 3 9.02229 3H5.2C4.0799 3 3.51984 3 3.09202 3.21799C2.71569 3.40973 2.40973 3.71569 2.21799 4.09202C2 4.51984 2 5.0799 2 6.2V7M2 7H17.2C18.8802 7 19.7202 7 20.362 7.32698C20.9265 7.6146 21.3854 8.07354 21.673 8.63803C22 9.27976 22 10.1198 22 11.8V16.2C22 17.8802 22 18.7202 21.673 19.362C21.3854 19.9265 20.9265 20.3854 20.362 20.673C19.7202 21 18.8802 21 17.2 21H6.8C5.11984 21 4.27976 21 3.63803 20.673C3.07354 20.3854 2.6146 19.9265 2.32698 19.362C2 18.7202 2 17.8802 2 16.2V7ZM12 17V11M9 14H15"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Обновить",callback:()=>{this._updateTree(),this._navigate(this.curDirPath)},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M2.6001 14C2.6001 14 2.72142 14.8492 6.23614 18.364C9.75086 21.8787 15.4493 21.8787 18.9641 18.364C20.2093 17.1187 21.0134 15.5993 21.3763 14M2.6001 14V20M2.6001 14H8.6001M22.6001 10C22.6001 10 22.4788 9.15076 18.9641 5.63604C15.4493 2.12132 9.75086 2.12132 6.23614 5.63604C4.99086 6.88131 4.18679 8.40072 3.82393 10M22.6001 10V4M22.6001 10H16.6001"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Готово",callback:()=>{this.onSave()},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path d="M5.20007 12L10.2001 17L19.2001 8" stroke="#1461CC" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                `}]),this.toolbarFolder=new Toolbar("#f-tapbar-folder",[{name:"Отмена",callback:()=>{this.filesMobile.querySelectorAll(".folder-card-mob").forEach(e=>{e.classList.remove("folder-card-mob_active")}),this._activateMobileTapbar(this.toolbarDefault)},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path d="M14.8 6L8.80005 12L14.8 18" stroke="#1461CC" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                `},{name:"Загрузить",callback:()=>{this.modalFiles.open()},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M21.4 15V16.2C21.4 17.8802 21.4 18.7202 21.073 19.362C20.7854 19.9265 20.3265 20.3854 19.762 20.673C19.1203 21 18.2802 21 16.6 21H8.20002C6.51987 21 5.67979 21 5.03805 20.673C4.47357 20.3854 4.01462 19.9265 3.727 19.362C3.40002 18.7202 3.40002 17.8802 3.40002 16.2V15M17.4 8L12.4 3M12.4 3L7.40002 8M12.4 3V15"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Создать",callback:e=>{this.curDirPath=e.target.dataset.path,this.modalCreate.callback=()=>this._createFolder(this.curDirPath),this.modalCreate.open()},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path
                    d="M13 7L11.8845 4.76892C11.5634 4.1268 11.4029 3.80573 11.1634 3.57116C10.9516 3.36373 10.6963 3.20597 10.4161 3.10931C10.0992 3 9.74021 3 9.02229 3H5.2C4.0799 3 3.51984 3 3.09202 3.21799C2.71569 3.40973 2.40973 3.71569 2.21799 4.09202C2 4.51984 2 5.0799 2 6.2V7M2 7H17.2C18.8802 7 19.7202 7 20.362 7.32698C20.9265 7.6146 21.3854 8.07354 21.673 8.63803C22 9.27976 22 10.1198 22 11.8V16.2C22 17.8802 22 18.7202 21.673 19.362C21.3854 19.9265 20.9265 20.3854 20.362 20.673C19.7202 21 18.8802 21 17.2 21H6.8C5.11984 21 4.27976 21 3.63803 20.673C3.07354 20.3854 2.6146 19.9265 2.32698 19.362C2 18.7202 2 17.8802 2 16.2V7ZM12 17V11M9 14H15"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Изменить",callback:e=>{const t=this.curDirPath;var i=t.split("/").at(-1);this.modalRename.open({callback:()=>{this.curDirPath=replaceLastPathElement(t,""),this._renameFolder(t,this.modalRename.getName())},path:t,prevName:i})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M11.6001 4.00001H7.4001C5.71994 4.00001 4.87986 4.00001 4.23813 4.32699C3.67364 4.61461 3.2147 5.07356 2.92708 5.63804C2.6001 6.27978 2.6001 7.11986 2.6001 8.80001V17.2C2.6001 18.8802 2.6001 19.7203 2.92708 20.362C3.2147 20.9265 3.67364 21.3854 4.23813 21.673C4.87986 22 5.71994 22 7.4001 22H15.8001C17.4803 22 18.3203 22 18.9621 21.673C19.5266 21.3854 19.9855 20.9265 20.2731 20.362C20.6001 19.7203 20.6001 18.8802 20.6001 17.2V13M8.60007 16H10.2746C10.7638 16 11.0084 16 11.2386 15.9448C11.4426 15.8958 11.6377 15.815 11.8167 15.7053C12.0185 15.5816 12.1915 15.4087 12.5374 15.0628L22.1001 5.50001C22.9285 4.67159 22.9285 3.32844 22.1001 2.50001C21.2717 1.67159 19.9285 1.67159 19.1001 2.50001L9.53733 12.0628C9.19143 12.4087 9.01848 12.5816 8.89479 12.7834C8.78513 12.9624 8.70432 13.1575 8.65533 13.3616C8.60007 13.5917 8.60007 13.8363 8.60007 14.3255V16Z"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Удалить",callback:()=>{this.modalDelete.open({title:"Удалить папку",callback:()=>{this._onFolderDelete(replaceLastPathElement(this.curDirPath,""))}})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M9.19995 3H15.2M3.19995 6H21.2M19.2 6L18.4987 16.5193C18.3934 18.0975 18.3408 18.8867 18 19.485C17.6999 20.0118 17.2472 20.4353 16.7016 20.6997C16.0819 21 15.291 21 13.7093 21H10.6906C9.10886 21 8.31798 21 7.69829 20.6997C7.15271 20.4353 6.70004 20.0118 6.39993 19.485C6.05906 18.8867 6.00645 18.0975 5.90124 16.5193L5.19995 6"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `}]),this.toolbarFile=new Toolbar("#f-tapbar-file",[{name:"Отмена",callback:()=>{this.filesMobile.querySelectorAll(".file-card-mob").forEach(e=>{e.classList.remove("file-card-mob_active"),this.curFilePath="",this._activateMobileTapbar(this.toolbarDefault)})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path d="M14.8 6L8.80005 12L14.8 18" stroke="#1461CC" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                `},{name:"Скачать",callback:()=>{const e=this.curFilePath.split("/").pop();download(this.apiBase+("?method=download&path="+this.curFilePath),e).then(()=>{this.notify.addNotification({title:`Файл: ${e} скачивается`})})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path d="M21.4001 15V16.2C21.4001 17.8802 21.4001 18.7202 21.0732 19.362C20.7855 19.9265 20.3266 20.3854 19.7621 20.673C19.1204 21 18.2803 21 16.6001 21H8.20015C6.51999 21 5.67991 21 5.03817 20.673C4.47369 20.3854 4.01475 19.9265 3.72713 19.362C3.40015 18.7202 3.40015 17.8802 3.40015 16.2V15M17.4001 10L12.4001 15M12.4001 15L7.40015 10M12.4001 15V3" stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                `},{name:"Путь",callback:()=>{copyToClipboard(this.curFilePath),this.notify.addNotification({title:"Путь скопирован"})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M8 8V5.2C8 4.0799 8 3.51984 8.21799 3.09202C8.40973 2.71569 8.71569 2.40973 9.09202 2.21799C9.51984 2 10.0799 2 11.2 2H18.8C19.9201 2 20.4802 2 20.908 2.21799C21.2843 2.40973 21.5903 2.71569 21.782 3.09202C22 3.51984 22 4.0799 22 5.2V12.8C22 13.9201 22 14.4802 21.782 14.908C21.5903 15.2843 21.2843 15.5903 20.908 15.782C20.4802 16 19.9201 16 18.8 16H16M5.2 22H12.8C13.9201 22 14.4802 22 14.908 21.782C15.2843 21.5903 15.5903 21.2843 15.782 20.908C16 20.4802 16 19.9201 16 18.8V11.2C16 10.0799 16 9.51984 15.782 9.09202C15.5903 8.71569 15.2843 8.40973 14.908 8.21799C14.4802 8 13.9201 8 12.8 8H5.2C4.0799 8 3.51984 8 3.09202 8.21799C2.71569 8.40973 2.40973 8.71569 2.21799 9.09202C2 9.51984 2 10.0799 2 11.2V18.8C2 19.9201 2 20.4802 2.21799 20.908C2.40973 21.2843 2.71569 21.5903 3.09202 21.782C3.51984 22 4.07989 22 5.2 22Z" stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                `},{name:"Изменить",callback:e=>{var t=this.curFilePath.split("/").pop();this.curDirPath=replaceLastPathElement(this.curFilePath,""),this.modalRename.open({path:this.curFilePath,prevName:t,callback:()=>this._renameFile(this.curFilePath,this.modalRename.getName())})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M11.6001 4.00001H7.4001C5.71994 4.00001 4.87986 4.00001 4.23813 4.32699C3.67364 4.61461 3.2147 5.07356 2.92708 5.63804C2.6001 6.27978 2.6001 7.11986 2.6001 8.80001V17.2C2.6001 18.8802 2.6001 19.7203 2.92708 20.362C3.2147 20.9265 3.67364 21.3854 4.23813 21.673C4.87986 22 5.71994 22 7.4001 22H15.8001C17.4803 22 18.3203 22 18.9621 21.673C19.5266 21.3854 19.9855 20.9265 20.2731 20.362C20.6001 19.7203 20.6001 18.8802 20.6001 17.2V13M8.60007 16H10.2746C10.7638 16 11.0084 16 11.2386 15.9448C11.4426 15.8958 11.6377 15.815 11.8167 15.7053C12.0185 15.5816 12.1915 15.4087 12.5374 15.0628L22.1001 5.50001C22.9285 4.67159 22.9285 3.32844 22.1001 2.50001C21.2717 1.67159 19.9285 1.67159 19.1001 2.50001L9.53733 12.0628C9.19143 12.4087 9.01848 12.5816 8.89479 12.7834C8.78513 12.9624 8.70432 13.1575 8.65533 13.3616C8.60007 13.5917 8.60007 13.8363 8.60007 14.3255V16Z"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `},{name:"Удалить",callback:()=>{this.modalDelete.open({title:"Удалить файл",callback:()=>{this._onFileDelete()}})},icon:`
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
                    <path
                    d="M9.19995 3H15.2M3.19995 6H21.2M19.2 6L18.4987 16.5193C18.3934 18.0975 18.3408 18.8867 18 19.485C17.6999 20.0118 17.2472 20.4353 16.7016 20.6997C16.0819 21 15.291 21 13.7093 21H10.6906C9.10886 21 8.31798 21 7.69829 20.6997C7.15271 20.4353 6.70004 20.0118 6.39993 19.485C6.05906 18.8867 6.00645 18.0975 5.90124 16.5193L5.19995 6"
                    stroke="#1461CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                `}]),this.modalFiles=new ModalFileUploader("#modal-files",".js--fm-modal-files",()=>{this._updateFiles(this.curDirPath)}),this.modalCreate=new ModalCreateFolder("#modal-create",".js--fm-modal-create",e=>{this.onCreateDirSave(e)}),this.modalRename=new ModalRename("#modal-rename",".js--fm-modal-rename"),this.modalDelete=new ModalDelete("#modal-delete"),this.fileContextMenu=new ContextMenu(fileContext,[{name:"Переименовать",callback:e=>{const t=e.target.getAttribute("path");e=e.target.dataset.name;this.modalRename.open({callback:e=>{this._renameFile(t,e)},path:t,prevName:e})}},{name:"Скачать",callback:e=>{this._downloadFile(e)}},{name:"Копировать путь",callback:e=>{this._copyFilePath(e)}},{name:"Удалить",callback:()=>{this.modalDelete.open({title:"Удалить файл",callback:()=>{this._onFileDelete()}})}}]),this.folderContextMenu=new ContextMenu(folderContext,[{name:"Создать папку",callback:e=>{this.curDirPath=e.target.dataset.path,this.modalCreate.open()}},{name:"Переименовать",callback:e=>{const t=e.target.dataset.path;e=t.split("/").at(-1);this.modalRename.open({callback:()=>{this.curDirPath=replaceLastPathElement(t,this.modalRename.getName()),this._renameFolder(t,this.modalRename.getName())},path:t,prevName:e})}},{name:"Копировать путь",callback:e=>{this._copyFolderPath(e)}},{name:"Загрузить файлы",callback:()=>{this.modalFiles.open()}},{name:"Удалить",callback:()=>{this.modalDelete.open({title:"Удалить папку",callback:()=>{this._onFolderDelete()}})}}]),this.notify=new NotificationStack(this.workspace),this.root.querySelectorAll("[data-tip]").forEach(e=>{tippy(e,{content:e.dataset.tip,arrow:!1,placement:"bottom",duration:0})}),this._updateTree(),this._updateFiles(),this._updateBreadcrumbs(""),this._events(),this._updateFileInfo(),iniitTextFields()},onCreateDirSave(e){this._createFolder(this.curDirPath,e)},onMobileCreateDirSave(){},_mapErrorCodeToStr(e){switch(e){case"network_error":return"Ошибка сети";case"unknown_error":return"Неизвестная ошибка";case"not_authenticated":return"Нет доступа";case"method_not_found":return"Метод не найден";case"invalid_path":return"Неверный путь";case"invalid_name":return"Неверное имя";case"no_permissions":case"file_too_large":case"nothing_uploaded":return"Недостаточно прав";case"does_not_exist":return"Файл или папка не существует";case"already_exists":return"Такой файл или папка уже существует"}return"Неизвестная ошибка"},_reportError(e){this.notify.addNotification({title:this._mapErrorCodeToStr(e)})},_events(){this.tree.addEventListener("contextmenu",e=>{(e.target.closest(".link-menu")?(e.preventDefault(),this.folderContextMenu.show(e),this.fileContextMenu):this.folderContextMenu).hide()}),this.fileGrid.addEventListener("contextmenu",e=>{(e.target.closest(".f-card")?(e.preventDefault(),this.curFilePath="",this.fileContextMenu.show(e),this.folderContextMenu):this.fileContextMenu).hide()}),this.root.querySelectorAll(".js--fm-delete-file").forEach(e=>{e.addEventListener("click",()=>{this.modalDelete.open({title:"Удалить файл",callback:()=>{this._onFileDelete()}})})}),this.root.querySelectorAll(".js--fm-delete-folder").forEach(e=>{e.addEventListener("click",()=>{this.modalDelete.open({title:"Удалить папку",callback:()=>{this._onFolderDelete()}})})}),this.root.querySelectorAll(".js--fm-refresh").forEach(e=>{e.addEventListener("click",()=>{this._updateTree(),this._navigate(this.curDirPath)})}),this.root.querySelectorAll(".js--fm-home").forEach(e=>{e.addEventListener("click",()=>{this.curDirPath="",this.curFilePath="",this._navigate("")})}),this.root.querySelectorAll(".js--fm-close").forEach(e=>{e.addEventListener("click",()=>{this.close()})}),this.root.querySelectorAll(".js--fm-save").forEach(e=>{e.addEventListener("click",()=>{this.onSave()})})},async _getTree(){try{var e,t=await fetch(this.apiBase+"?method=getTree");return t.ok?(e=await t.json()).success?e.data:(this._reportError(e.error),[]):(this._reportError("network_error"),[])}catch(e){this._reportError("unknown_error"),console.error("Something went wrong... \n\n",e)}},async _getFiles(e="",t=!1){try{var i,a=await fetch(this.apiBase+`?method=getFileList&path=${e}&include_dirs=`+(t?1:0));return a.ok?(i=await a.json()).success?i.data:(this._reportError(i.error),[]):(this._reportError("network_error"),[])}catch(e){this._reportError("unknown_error"),console.error("Something went wrong... \n\n",e)}},async _createDir(e,t){try{var i,a,r=await fetch(this.apiBase+`?method=createDir&path=${e}&name=`+t);return r.ok?(i=await r.json()).success?""===(a=i.data).error||(this._reportError(a.error),!1):(this._reportError(i.error),!1):(this._reportError("network_error"),!1)}catch(e){this._reportError("unknown_error"),console.log(e)}},async _rename(e,t){try{var i,a,r=await fetch(this.apiBase+`?method=rename&path=${e}&name=`+t);return r.ok?(i=await r.json()).success?""===(a=i.data).error||(this._reportError(a.error),!1):(this._reportError(i.error),!1):(this._reportError("network_error"),!1)}catch(e){this._reportError("unknown_error"),console.log(e)}},async _unlink(e){try{var t,i,a=await fetch(this.apiBase+"?method=delete&path="+e);return a.ok?(t=await a.json()).success?""===(i=t.data).error||(this._reportError(i.error),!1):(this._reportError(t.error),!1):(this._reportError("network_error"),!1)}catch(e){this._reportError("unknown_error"),console.log(e)}},_sortItemsByName(e){return(e??[]).sort(function(e,t){return e.name.localeCompare(t.name)})},_sortItemsByType(e){let t=[],i=[];if(!e)return[];for(const a of e)("dir"===a.type?t:i).push(a);return t=this._sortItemsByName(t),i=this._sortItemsByName(i),[...t,...i]},_updateTree(){this._getTree().then(e=>{this.tree.innerHTML="",(e=this._sortItemsByName(e)).forEach(e=>{var e=this._createFolderHTML(e),t=(this.tree.appendChild(e),e.querySelectorAll("[data-path]"));let i=0;t.forEach((e,t)=>{e.dataset.path===this.curDirPath&&(i=t+1)});for(let e=0;e<i;e++){var a=t[e].parentElement.parentElement;"DETAILS"===a.tagName&&a.setAttribute("open",""),e===i-1&&t[e].classList.add("link-menu_active")}})})},_updateFiles(e=""){this._getFiles(e,!0).then(e=>{this.fileGrid.innerHTML="",this.filesMobile.innerHTML="",(e=this._sortItemsByType(e)).forEach(e=>{"dir"!==(this.files[e.path]=e).type?(this.fileGrid.appendChild(this._createFileHTML(e)),this.filesMobile.appendChild(this._createFileMobileHTML(e))):this.filesMobile.appendChild(this._createFolderMobileHTML(e))}),this.root.querySelectorAll(".js--fm-delete-file").forEach(e=>{e.style.display="none"})})},_updateBreadcrumbs(e){const i=e.split("/");let a=this.breadcrumbs.innerHTML="";this._activateMobileTapbar(this.toolbarDefault),i.forEach((e,t)=>{e&&(a+="/"+e,this.breadcrumbs.appendChild(this._createBreadcrumbHTML(e,a,t===i.length-1)))})},_navigate(e){this.curPath=e,this._updateBreadcrumbs(e),this._updateFiles(e)},_createFolder(t,i){this._createDir(t||this.curPath,i).then(e=>{e&&(this._updateTree(),this._updateFiles(t),this.notify.addNotification({title:`Папка ${i} создана`}))})},_renameFolder(e,t){this._rename(e,t).then(e=>{e&&(this._updateTree(),this._updateFiles(this.curDirPath),this.notify.addNotification({title:"Папка переименована"}))})},_copyFolderPath(e){e.target.dataset.path;this.notify.addNotification({title:"Путь скопирован"})},_uploadFiles(e){},_renameFile(e,t){this._rename(e,t).then(e=>{e&&(this._updateTree(),this._updateFiles(this.curPath),this.notify.addNotification({title:"Файл переименована"}))})},_copyFilePath(e){e=""+e.target.getAttribute("path");copy(e),this.notify.addNotification({title:"Путь скопирован"})},_downloadFile(e){var t=e.target.getAttribute("path");const i=e.target.dataset.name;download(this.apiBase+"?method=download&path="+t,i).then(()=>{this.notify.addNotification({title:`Файл: ${i} скачивается`})})},_delete(){},_updateFileInfo(e){var t,i,a,r,s=this.root.querySelector(".f-manager__info");e?(t=s.querySelector(".f-manager__info-title"),i=s.querySelector(".f-manager__info-param_size span"),a=s.querySelector(".f-manager__info-param_dimensions span"),r=s.querySelector(".f-manager__info-param_edited span"),t.textContent=e.title,i.textContent=e.size+" "+e.size_ext,a.textContent=e.dimensions,r.textContent=e.edited,s.style.display="flex",t.style.display=e.title?"inline":"none",i.parentElement.style.display=e.size?"flex":"none",a.parentElement.style.display=e.dimensions?"flex":"none",r.parentElement.style.display=e.edited?"flex":"none"):s.style.display="none"},_createFolderHTML(i,a=2){var e=document.createElement("li");if(i.data&&0<i.data.length){var r=document.createElement("details"),s=document.createElement("summary");s.innerHTML=`
                <div path="${i.path}" class="link-menu link-menu_has-children">
                    <button class="link-menu__tree btn-tree">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M6.86193 10.4714C6.60158 10.211 6.60158 9.78893 6.86193 9.52859L8.39052 7.99999L6.86193 6.47139C6.60158 6.21104 6.60158 5.78893 6.86193 5.52859C7.12228 5.26824 7.54439 5.26824 7.80474 5.52859L9.80474 7.52858C10.0651 7.78893 10.0651 8.21104 9.80474 8.47139L7.80474 10.4714C7.54439 10.7317 7.12228 10.7317 6.86193 10.4714Z" fill="#1975F7"></path>
                        </svg>
                    </button>
                    <button class="link-menu__control">
                        <svg class="link-menu__icon link-menu__icon_folder" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                          <path d="M8.66667 4.66667L7.92297 3.17928C7.70894 2.7512 7.60191 2.53715 7.44225 2.38078C7.30105 2.24249 7.13088 2.13732 6.94405 2.07287C6.73278 2 6.49347 2 6.01486 2H3.46667C2.71993 2 2.34656 2 2.06135 2.14532C1.81047 2.27316 1.60649 2.47713 1.47866 2.72801C1.33334 3.01323 1.33334 3.3866 1.33334 4.13333V4.66667M1.33334 4.66667H11.4667C12.5868 4.66667 13.1468 4.66667 13.5746 4.88465C13.951 5.0764 14.2569 5.38236 14.4487 5.75869C14.6667 6.18651 14.6667 6.74656 14.6667 7.86667V10.8C14.6667 11.9201 14.6667 12.4802 14.4487 12.908C14.2569 13.2843 13.951 13.5903 13.5746 13.782C13.1468 14 12.5868 14 11.4667 14H4.53334C3.41323 14 2.85318 14 2.42535 13.782C2.04903 13.5903 1.74307 13.2843 1.55132 12.908C1.33334 12.4802 1.33334 11.9201 1.33334 10.8V4.66667Z" stroke="#63A1F7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <span class="link-menu__text">
                          ${i.name}
                        </span>
                    </button>
                </div>
            `;let t=document.createElement("ul");t.style="--nesting: "+a,i.data.forEach(e=>{t.appendChild(this._createFolderHTML(e,a+1))}),r.appendChild(s),r.appendChild(t),new Accordion(r),e.appendChild(r)}else e.innerHTML=`
                <div path="${i.path}" class="link-menu">
                    <button class="link-menu__tree btn-tree">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M6.86193 10.4714C6.60158 10.211 6.60158 9.78893 6.86193 9.52859L8.39052 7.99999L6.86193 6.47139C6.60158 6.21104 6.60158 5.78893 6.86193 5.52859C7.12228 5.26824 7.54439 5.26824 7.80474 5.52859L9.80474 7.52858C10.0651 7.78893 10.0651 8.21104 9.80474 8.47139L7.80474 10.4714C7.54439 10.7317 7.12228 10.7317 6.86193 10.4714Z" fill="#1975F7"></path>
                    </svg>
                    </button>
                    <button class="link-menu__control">
                        <svg class="link-menu__icon link-menu__icon_folder" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8.66667 4.66667L7.92297 3.17928C7.70894 2.7512 7.60191 2.53715 7.44225 2.38078C7.30105 2.24249 7.13088 2.13732 6.94405 2.07287C6.73278 2 6.49347 2 6.01486 2H3.46667C2.71993 2 2.34656 2 2.06135 2.14532C1.81047 2.27316 1.60649 2.47713 1.47866 2.72801C1.33334 3.01323 1.33334 3.3866 1.33334 4.13333V4.66667M1.33334 4.66667H11.4667C12.5868 4.66667 13.1468 4.66667 13.5746 4.88465C13.951 5.0764 14.2569 5.38236 14.4487 5.75869C14.6667 6.18651 14.6667 6.74656 14.6667 7.86667V10.8C14.6667 11.9201 14.6667 12.4802 14.4487 12.908C14.2569 13.2843 13.951 13.5903 13.5746 13.782C13.1468 14 12.5868 14 11.4667 14H4.53334C3.41323 14 2.85318 14 2.42535 13.782C2.04903 13.5903 1.74307 13.2843 1.55132 12.908C1.33334 12.4802 1.33334 11.9201 1.33334 10.8V4.66667Z" stroke="#63A1F7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <span class="link-menu__text">
                        ${i.name}
                        </span>
                    </button>
                </div>
            `;const t=e.querySelector(".link-menu");return t.querySelector(".link-menu__tree").addEventListener("click",e=>{e.stopPropagation(),0<i.data.length&&t.parentElement.dispatchEvent(new Event("click"))}),t.dataset.path=i.path,this._onFolderSelect(t,i),e},_onFolderSelect(i,a){i.addEventListener("click",e=>{this.curFilePath="",this.curDirPath=a.path,this._navigate(a.path);var t=i.parentElement.parentElement;this._updateFileInfo(),this.modalFiles.setPath(a.path),this.root.querySelectorAll(".js--fm-delete-folder").forEach(e=>{e.style.display="flex"}),this.tree.querySelectorAll(".link-menu").forEach(e=>{e.classList.remove("link-menu_active")}),i.classList.add("link-menu_active"),t&&t.hasAttribute("open")&&(t.setAttribute("open",""),e.stopPropagation())})},_onFolderDelete(e=""){this._unlink(this.curDirPath),this._updateFiles(e),this.curDirPath=replaceLastPathElement(this.curDirPath,""),this._updateTree(),this._updateBreadcrumbs(this.curDirPath.split("/").at(-2)),this.notify.addNotification({title:"Папка удалена"}),this.root.querySelectorAll(".js--fm-delete-folder").forEach(e=>{e.style.display="none"})},_onFileDelete(){this._unlink(this.curFilePath),this._updateFiles(this.curDirPath),this.notify.addNotification({title:"Файл удален"}),this.root.querySelectorAll(".js--fm-delete-file").forEach(e=>{e.style.display="none"})},_onFileSelect(e,t){this.currFileName=t.name,this.fileGrid.querySelectorAll(".f-card").forEach(e=>{e.classList.remove("f-card_active")}),this.root.querySelectorAll(".js--fm-delete-file").forEach(e=>{e.style.display="flex"}),this.curFilePath=t.path,e.classList.add("f-card_active"),this._updateFileInfo({title:t.name,size:t.size,dimensions:t.dimensions,edited:t.edited,size_ext:t.size_ext})},_onMobileFileSelect(e){},_onMobileFolderSelect(e){},_createFileHTML(e){const t=document.createElement("div");t.classList.add("f-card"),t.setAttribute("path",e.path),t.setAttribute("data-name",e.name);var i=e.name.split("."),a=e.name.replace(/\.[^/.]+$/,"");t.innerHTML=`
            <a href="${e.path}" class="f-card__link f-card__link_download" download></a>
            <div class="f-card__image-wrapper">
              <div class="f-card__size">${e.size} ${e.size_ext}</div>
              <img src="${e.is_pic?this.rootDir+e.path:this.assetsDir+"/img/file-img-placeholder.jpg"}" alt="" class="f-card__img">
            </div>
            <span class="f-card__title">
              <span class="f-card__filename">${a}${1<i.length?".":""}</span>
              <span class="f-card__ext">${1<i.length?i.pop():""}</span>
            </span>
        `,t.addEventListener("click",()=>this._onFileSelect(t,e));const r=e=>{try{e.target&&!e.target.className.includes("f-card")&&(t.classList.remove("f-card_active"),this._updateFileInfo())}catch(e){window.removeEventListener("click",r)}};return window.addEventListener("click",r),t},_createFolderMobileHTML(t){const i=document.createElement("div");return i.classList.add("folder-card-mob"),i.setAttribute("data-path",t.path),i.innerHTML=`
            <i class="folder-card-mob__icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M13 7L11.8845 4.76892C11.5634 4.1268 11.4029 3.80573 11.1634 3.57116C10.9516 3.36373 10.6963 3.20597 10.4161 3.10931C10.0992 3 9.74021 3 9.02229 3H5.2C4.0799 3 3.51984 3 3.09202 3.21799C2.71569 3.40973 2.40973 3.71569 2.21799 4.09202C2 4.51984 2 5.0799 2 6.2V7M2 7H17.2C18.8802 7 19.7202 7 20.362 7.32698C20.9265 7.6146 21.3854 8.07354 21.673 8.63803C22 9.27976 22 10.1198 22 11.8V16.2C22 17.8802 22 18.7202 21.673 19.362C21.3854 19.9265 20.9265 20.3854 20.362 20.673C19.7202 21 18.8802 21 17.2 21H6.8C5.11984 21 4.27976 21 3.63803 20.673C3.07354 20.3854 2.6146 19.9265 2.32698 19.362C2 18.7202 2 17.8802 2 16.2V7Z" stroke="#63A1F7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </i>
            <div class="folder-card-mob__info">
              <span class="folder-card-mob__title">${t.name}</span>
              <div class="folder-card-mob__params">
                ${t.count?`
                    <span class="folder-card-mob__params-item folder-card-mob__params-item_date">${t.edited}</span>
                    <span class="folder-card-mob__params-item folder-card-mob__params-item_size"> ${formatEnding(t.count,["файл","файла","файлов"])}</span>
                    `:""}
              </div>
            </div>
        `,i.addEventListener("click",()=>{this.curDirPath=t.path,this.modalFiles.setPath(this.curDirPath),this._navigate(t.path),this.curFilePath=""}),i.addEventListener("contextmenu",e=>{e.preventDefault(),this.filesMobile.querySelectorAll(".file-card-mob").forEach(e=>{e.classList.remove("file-card-mob_active")}),this.filesMobile.querySelectorAll(".folder-card-mob").forEach(e=>{e.classList.remove("folder-card-mob_active")}),this.curDirPath=t.path,i.classList.add("folder-card-mob_active"),this._activateMobileTapbar(this.toolbarFolder)}),i},_createFileMobileHTML(t){const i=document.createElement("div");i.classList.add("file-card-mob"),i.setAttribute("data-path",t.path);var e=t.name.split(".");return i.innerHTML=`
            <img src="${t.is_pic?this.rootDir+t.path:this.assetsDir+"/img/file-img-placeholder-mob.webp"}" alt="" class="file-card-mob__img">
            <div class="file-card-mob__info">
              <div class="file-card-mob__title">
                <span class="file-card-mob__title_text">${removeFileExtenstion(t.name)}${1<e.length?".":""}</span>
                <span class="file-card-mob__title_ext">  ${1<e.length?e.pop():""}</span>
              </div>
              <div class="file-card-mob__params">
                <span class="file-card-mob__params-item file-card-mob__params-item_date">${t.edited}</span>
                <span class="file-card-mob__params-item file-card-mob__params-item_size">${t.size} ${t.size_ext}</span>
              </div>
            </div>
        `,i.addEventListener("click",e=>{this.filesMobile.querySelectorAll(".folder-card-mob").forEach(e=>{e.classList.remove("folder-card-mob_active")}),this.filesMobile.querySelectorAll(".file-card-mob").forEach(e=>{e.classList.remove("file-card-mob_active")}),this.curFilePath=t.path,i.classList.add("file-card-mob_active")}),i.addEventListener("contextmenu",e=>{e.preventDefault(),this.filesMobile.querySelectorAll(".folder-card-mob").forEach(e=>{e.classList.remove("folder-card-mob_active")}),this.filesMobile.querySelectorAll(".file-card-mob").forEach(e=>{e.classList.remove("file-card-mob_active")}),this.curFilePath=t.path,this._activateMobileTapbar(this.toolbarFile),i.classList.add("file-card-mob_active")}),i},_createBreadcrumbHTML(e,t,i){var a=document.createElement("span");return a.setAttribute("path",t),a.classList.add("link-nav"),i?a.textContent=e:a.innerHTML=`
                ${e}
                <i class="link-nav__icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M6.86192 10.4714C6.60157 10.211 6.60157 9.78893 6.86192 9.52859L8.39051 7.99999L6.86192 6.47139C6.60157 6.21104 6.60157 5.78893 6.86192 5.52859C7.12227 5.26824 7.54438 5.26824 7.80473 5.52859L9.80473 7.52858C10.0651 7.78893 10.0651 8.21104 9.80473 8.47139L7.80473 10.4714C7.54438 10.7317 7.12227 10.7317 6.86192 10.4714Z" fill="#1461CC"></path>
                  </svg>
                </i>
            `,i||a.addEventListener("click",()=>{this.curDirPath=t,this._navigate(t)}),a},_activateMobileTapbar(e){this.toolbarDefault.close(),this.toolbarFolder.close(),this.toolbarFile.close(),e.open()},onSave(){this.callback(this.curFilePath),this.root.remove()},close(){this.root.remove()}},dropArea=(window.fileManager=FileManager,(e,t)=>{const i=e.querySelector(".drop-area");function a(e){e.preventDefault(),e.stopPropagation()}function r(e){i.classList.add("drop-area--highlight")}function s(e){i.classList.remove("drop-area--highlight")}["dragenter","dragover","dragleave","drop"].forEach(e=>{i.addEventListener(e,a,!1),document.body.addEventListener(e,a,!1)}),["dragenter","dragover"].forEach(e=>{i.addEventListener(e,r,!1)}),["dragleave","drop"].forEach(e=>{i.addEventListener(e,s,!1)}),i.addEventListener("drop",t,!1)});document.querySelectorAll(".file-uploader-block").forEach(t=>{const C=t.querySelector(".file-uploader"),g=t.querySelector(".file-uploader__input"),w=t.querySelector(".file-uploader__files");t.querySelector(".drop-area");const r=t.querySelector(".progressbar__progress");var e=t.querySelector(".file-uploader__btn-cancel"),i=t.querySelector(".file-uploader__btn-upload");let b=[],s=[];let k=0;function a(e){if(w.style.display="flex",C.classList.add("file-uploader--loading"),r.style.width="0%",k=0,s.length)for(const i of e)s.push(i),w.appendChild(l(i));else{for(const a of e)a.type.startsWith("image/")&&(s.push(a),r.style.width=k+"%");w.innerHTML="";for(let e=0;e<s.length;e++){var t=s[e];w.appendChild(l(t))}}}function y(){var e=w.querySelectorAll(".file-uploader-file");let t=0;e.forEach(e=>{t+=parseFloat(e.dataset.progress)}),r.style.width=t/e.length+"%"}function L(t,e){var i=w.querySelector(`.file-uploader__file[data-file="${t}"]`);if(fetch("http://fmtest.master.et9.ru:10580/bootstrap.php?method=delete&path="+e),i){w.removeChild(i);e=s.filter(e=>e.name!==t);const a=new DataTransfer;e.forEach(e=>{a.items.add(e)}),s=e,g.files=a.files}fetch(""),w.style.display=s.length?"flex":"none"}function l(i){const{name:a,size:r}=i;var e=new FormData;e.append("file[]",i);const s=document.createElement("div");s.classList.add("file-uploader__file","file-uploader-file","file-uploader-file--loading"),s.setAttribute("data-file",a);var t=document.createElement("div");t.classList.add("file-uploader-file__img");const l=document.createElement("img");l.src="./file-img-uploader-placehlder.png",l.alt="",t.appendChild(l);var o=document.createElement("div"),n=(o.classList.add("file-uploader-file__info"),document.createElement("div")),d=(n.classList.add("file-uploader-file__info-top"),document.createElement("div")),c=(d.classList.add("file-uploader-file__title"),d.textContent=16<(m=a).length?(c=m.slice(2+(m.lastIndexOf(".")-1>>>0)),m.slice(0,9)+"..."+c):m,document.createElement("span")),h=(c.classList.add("file-uploader-file__size"),c.textContent=(m=r,(h=1024*(p=1048576))<=m?(m/h).toFixed(2)+" гб":p<=m?(m/p).toFixed(2)+" мб":1024<=m?(m/1024).toFixed(2)+" кб":m+" bytes"),document.createElement("div")),p=(h.classList.add("file-uploader-file__progress"),document.createElement("div")),m=(p.classList.add("progressbar"),document.createElement("div"));m.classList.add("progressbar__bg");const u=document.createElement("div");u.classList.add("progressbar__progress"),p.appendChild(m),p.appendChild(u),h.appendChild(p),n.appendChild(d),n.appendChild(c),n.appendChild(h);m=document.createElement("div");m.classList.add("file-uploader-file__info-btns");const f=document.createElement("button");f.type="button",f.classList.add("file-uploader-file__btn-delete","BtnIconLeft","BtnSecondarySm");p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttribute("xmlns","http://www.w3.org/2000/svg"),p.setAttribute("width","24"),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("fill-rule","evenodd"),d.setAttribute("clip-rule","evenodd"),d.setAttribute("d","M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z"),d.setAttribute("fill","white"),p.appendChild(d),f.appendChild(p),f.appendChild(document.createTextNode("Удалить")),h=document.createElement("button"),h.type="button",h.classList.add("file-uploader-file__btn-cancel","BtnIconLeft","BtnSecondarySm"),d=document.createElementNS("http://www.w3.org/2000/svg","svg"),d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("width","24"),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("fill-rule","evenodd"),p.setAttribute("clip-rule","evenodd"),p.setAttribute("d","M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z"),p.setAttribute("fill","white"),d.appendChild(p),h.appendChild(d),h.appendChild(document.createTextNode("Отмена")),h.addEventListener("click",()=>L(a)),m.appendChild(f),m.appendChild(h),o.appendChild(n),o.appendChild(m),s.appendChild(t),s.appendChild(o);const v=new FileReader,_=(v.onload=function(e){l.src=e.target.result},new XMLHttpRequest);return b.push(_),_.upload.addEventListener("progress",function(e){var t;e.loaded<=r&&(t=Math.round(e.loaded/r*100),u.style.width=t+"%",s.setAttribute("data-progress",t.toString()),k+=t,y()),e.loaded===e.total&&(u.style.width="100%",k=100)}),_.addEventListener("load",function(e){if(200===e.target.status){const t=JSON.parse(e.target.response)["data"];s.classList.remove("file-uploader-file--loading"),s.setAttribute("data-progress","100"),v.readAsDataURL(i),y(),0===w.querySelectorAll(".file-uploader-file--loading").length&&C.classList.remove("file-uploader--loading"),f.addEventListener("click",()=>L(a,t[0])),e=_,-1!==(e=b.indexOf(e))&&b.splice(e,1)}}),_.open("POST","http://fmtest.master.et9.ru:10580/bootstrap.php?method=upload&path="+g.dataset.path),_.timeout=45e3,_.send(e),s}i.addEventListener("click",e=>{g.dispatchEvent(new MouseEvent("click",{bubbles:!0}))}),e.addEventListener("click",e=>{e.stopPropagation(),s=[],b.forEach(e=>{e.abort()}),b=[],C.classList.remove("file-uploader--loading"),w.innerHTML="",w.style.display="none"}),g.addEventListener("change",e=>{e=e.target.files;e.length&&(s.length+e.length<=10?(t.classList.remove("file-uploader--error"),a(e)):(t.classList.add("file-uploader--error"),g.files=[]))}),dropArea(C,e=>{e=e.dataTransfer.files;s.length+e.length<=10?a(e):g.files=[]})});